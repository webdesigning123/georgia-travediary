/* book.css â€” layout & page-turn animation */
.book{
  display:grid;
  place-items:center;
}
.book-viewport{
  position:relative;
  width:min(100%, 960px);
  aspect-ratio: 16/10;
  margin: 1rem auto;
  perspective: 1600px;
}

.sheet, .sheet-face{
  position:absolute; inset:0;
  border-radius: var(--radius);
}
.sheet{
  display:grid; grid-template-columns: 1fr 1fr;
  gap: var(--page-gap);
  padding: clamp(.6rem, 1.5vw, 1rem);
  background: linear-gradient(90deg, hsl(var(--shadow)/.05), transparent 15%, transparent 85%, hsl(var(--shadow)/.05));
  box-shadow: var(--elev);
}
.page{
  background: hsl(var(--paper));
  color: hsl(var(--ink));
  border-radius: var(--radius);
  padding: clamp(.8rem, 1.2vw, 1rem);
  position:relative;
  overflow:hidden;
}
.page header{ margin-bottom:.6rem; }
.page .meta{ font-size:.9rem; opacity:.8; }
.page .photo{ margin:.5rem 0; }
.page .caption{ font-size:.9rem; opacity:.8; }

/* Cover variants */
.page--cover{
  display:grid; place-content:end start; background-size:cover; background-position:center;
  color:white; text-shadow: 0 2px 12px hsl(var(--shadow)/.6);
}
.page--cover .strapline{ font-weight:600; font-size: clamp(1.1rem, .9rem + 1.2vw, 1.6rem); }

/* Page number badges */
.page::after{
  content: attr(data-page);
  position:absolute; bottom:.5rem; right:.8rem; font-size:.85rem; opacity:.65;
}

/* Drag peel target */
.corner{
  position:absolute; width:48px; height:48px; bottom:0; right:0;
  border-top-left-radius: 12px;
  cursor: grab;
  background: radial-gradient(110% 110% at 110% 110%, hsl(var(--shadow)/.25) 0 20%, transparent 40%);
}
.corner:active{ cursor:grabbing; }

/* 3D flip animation */
.sheet.flip .page--right{
  transform-origin: left center;
  animation: pageFlip var(--dur, 420ms) var(--easing) forwards;
}
@keyframes pageFlip{
  0%{ transform: rotateY(0deg); box-shadow: 0 10px 30px hsl(var(--shadow)/.2); }
  100%{ transform: rotateY(-180deg); box-shadow: 0 6px 18px hsl(var(--shadow)/.15); }
}

/* Reduced motion fallback */
@media (prefers-reduced-motion: reduce){
  .book-viewport{ perspective: none; }
  .sheet.flip .page--right{ animation: fadeSlide var(--dur, 220ms) ease forwards; }
  @keyframes fadeSlide{
    from{ opacity:1; transform: translateX(0); }
    to{ opacity:0; transform: translateX(-12px); }
  }
}

/* Skeleton / states */
.skeleton{ position:absolute; inset:0; display:grid; grid-template-columns:1fr 1fr; gap:var(--page-gap); padding: clamp(.6rem, 1.5vw, 1rem); }
.sheet-skeleton{ border-radius:var(--radius); background: linear-gradient(90deg, hsl(var(--shadow)/.07), hsl(var(--shadow)/.02) 30%, hsl(var(--shadow)/.07) 60%); background-size:200% 100%; animation: pulse 1.2s linear infinite; }
@keyframes pulse{ from{ background-position: 0 0; } to{ background-position: 200% 0; } }
.error,.empty{ position:absolute; inset:0; display:grid; place-content:center; background:hsl(var(--paper)); border-radius:var(--radius); text-align:center; padding:1rem; }

/* Edge tap zones */
.tap-left, .tap-right{
  position:absolute; inset-block:0; width:12%; z-index:50;
}
.tap-left{ inset-inline-start:0; }
.tap-right{ inset-inline-end:0; }
.tap-left button, .tap-right button{ position:absolute; inset:0; width:100%; height:100%; background:transparent; border:0; }

/* Mini TOC */
.toc{ width:min(720px, 92vw); border:none; border-radius:16px; padding:0; box-shadow: var(--elev); }
.toc::backdrop{ background:hsl(var(--shadow)/.4); }
.toc-header{ display:flex; justify-content:space-between; align-items:center; padding: .8rem 1rem; border-bottom:1px solid hsl(var(--shadow)/.1); }
.toc-list{ padding: .5rem 1rem 1rem; display:grid; gap:.25rem; max-block-size: 55vh; overflow:auto; }
.toc-list a{ display:flex; justify-content:space-between; padding:.5rem .65rem; border-radius:10px; border:1px solid hsl(var(--shadow)/.08); background:hsl(var(--bg)); }
.toc-list a:hover{ border-color:hsl(var(--ring)); }

/* Paper sheen (reactive light) */
.page::before{
  content:""; position:absolute; inset:0;
  background: radial-gradient(1200px 400px at var(--mx, 0%) var(--my, 0%), hsl(0 0% 100%/.22), transparent 60%);
  pointer-events:none; mix-blend-mode: screen; opacity:.35; transition: opacity .2s ease;
}
.page[data-sheen="off"]::before{ opacity:0; }

/* Responsive: stack vertically on narrow */
@media (max-width: 720px){
  .book-viewport{ aspect-ratio: 3/4; }
  .sheet{ grid-template-columns: 1fr; }
  .page::after{ right:.6rem; }
}
